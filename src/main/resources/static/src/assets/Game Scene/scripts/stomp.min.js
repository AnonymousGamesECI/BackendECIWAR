(function(){var y,i,b,c,o={}.hasOwnProperty,s=[].slice;y={LF:"\n",NULL:"\0"},b=function(){var s;function m(t,n,e){this.command=t,this.headers=null!=n?n:{},this.body=null!=e?e:""}return m.prototype.toString=function(){var t,n,e,i,r;for(n in t=[this.command],(e=!1===this.headers["content-length"])&&delete this.headers["content-length"],r=this.headers)o.call(r,n)&&(i=r[n],t.push(n+":"+i));return this.body&&!e&&t.push("content-length:"+m.sizeOfUTF8(this.body)),t.push(y.LF+this.body),t.join(y.LF)},m.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},s=function(t){var n,e,i,r,o,s,u,a,c,h,f,p,l,d,g,b,v;for(r=t.search(RegExp(""+y.LF+y.LF)),i=(o=t.substring(0,r).split(y.LF)).shift(),s={},p=function(t){return t.replace(/^\s+|\s+$/g,"")},l=0,g=(b=o.reverse()).length;l<g;l++)a=(h=b[l]).indexOf(":"),s[p(h.substring(0,a))]=p(h.substring(a+1));if(n="",f=r+2,s["content-length"])c=parseInt(s["content-length"]),n=(""+t).substring(f,f+c);else for(e=null,u=d=f,v=t.length;(f<=v?d<v:v<d)&&(e=t.charAt(u))!==y.NULL;u=f<=v?++d:--d)n+=e;return new m(i,s,n)},m.unmarshall=function(r){var o;return function(){var t,n,e,i;for(i=[],t=0,n=(e=r.split(RegExp(""+y.NULL+y.LF+"*"))).length;t<n;t++)0<(null!=(o=e[t])?o.length:void 0)&&i.push(s(o));return i}()},m.marshall=function(t,n,e){return new m(t,n,e).toString()+y.NULL},m}(),i=function(){var g;function t(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return t.prototype.debug=function(t){var n;return"undefined"!=typeof window&&null!==window&&null!=(n=window.console)?n.log(t):void 0},g=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(t,n,e){var i;for(i=b.marshall(t,n,e),"function"==typeof this.debug&&this.debug(">>> "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+i.length)}},t.prototype._setupHeartbeat=function(r){var t,n,e,o,i,s,u,a;if((i=r.version)===c.VERSIONS.V1_1||i===c.VERSIONS.V1_2)return n=(s=function(){var t,n,e,i;for(i=[],t=0,n=(e=r["heart-beat"].split(",")).length;t<n;t++)o=e[t],i.push(parseInt(o));return i}())[0],t=s[1],0!==this.heartbeat.outgoing&&0!==t&&(e=Math.max(this.heartbeat.outgoing,t),"function"==typeof this.debug&&this.debug("send PING every "+e+"ms"),this.pinger=c.setInterval(e,(u=this,function(){return u.ws.send(y.LF),"function"==typeof u.debug?u.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==n?(e=Math.max(this.heartbeat.incoming,n),"function"==typeof this.debug&&this.debug("check PONG every "+e+"ms"),this.ponger=c.setInterval(e,(a=this,function(){var t;if(t=g()-a.serverActivity,2*e<t)return"function"==typeof a.debug&&a.debug("did not receive server activity for the last "+t+"ms"),a.ws.close()}))):void 0},t.prototype._parseConnect=function(){var t,n,e,i;switch(i={},(t=1<=arguments.length?s.call(arguments,0):[]).length){case 2:i=t[0],n=t[1];break;case 3:t[1]instanceof Function?(i=t[0],n=t[1],e=t[2]):(i.login=t[0],i.passcode=t[1],n=t[2]);break;case 4:i.login=t[0],i.passcode=t[1],n=t[2],e=t[3];break;default:i.login=t[0],i.passcode=t[1],n=t[2],e=t[3],i.host=t[4]}return[i,n,e]},t.prototype.connect=function(){var t,l,n,e,d,i,r;return t=1<=arguments.length?s.call(arguments,0):[],e=this._parseConnect.apply(this,t),n=e[0],this.connectCallback=e[1],l=e[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=(d=this,function(t){var i,r,n,e,o,s,u,a,c,h,f,p;if(e="undefined"!=typeof ArrayBuffer&&t.data instanceof ArrayBuffer?(i=new Uint8Array(t.data),"function"==typeof d.debug&&d.debug("--- got data length: "+i.length),function(){var t,n,e;for(e=[],t=0,n=i.length;t<n;t++)r=i[t],e.push(String.fromCharCode(r));return e}().join("")):t.data,d.serverActivity=g(),e!==y.LF){for("function"==typeof d.debug&&d.debug("<<< "+e),p=[],c=0,h=(f=b.unmarshall(e)).length;c<h;c++)switch((o=f[c]).command){case"CONNECTED":"function"==typeof d.debug&&d.debug("connected to server "+o.headers.server),d.connected=!0,d._setupHeartbeat(o.headers),p.push("function"==typeof d.connectCallback?d.connectCallback(o):void 0);break;case"MESSAGE":a=o.headers.subscription,(u=d.subscriptions[a]||d.onreceive)?(n=d,s=o.headers["message-id"],o.ack=function(t){return null==t&&(t={}),n.ack(s,a,t)},o.nack=function(t){return null==t&&(t={}),n.nack(s,a,t)},p.push(u(o))):p.push("function"==typeof d.debug?d.debug("Unhandled received MESSAGE: "+o):void 0);break;case"RECEIPT":p.push("function"==typeof d.onreceipt?d.onreceipt(o):void 0);break;case"ERROR":p.push("function"==typeof l?l(o):void 0);break;default:p.push("function"==typeof d.debug?d.debug("Unhandled frame: "+o):void 0)}return p}"function"==typeof d.debug&&d.debug("<<< PONG")}),this.ws.onclose=(i=this,function(){var t;return t="Whoops! Lost connection to "+i.ws.url,"function"==typeof i.debug&&i.debug(t),i._cleanUp(),"function"==typeof l?l(t):void 0}),this.ws.onopen=(r=this,function(){return"function"==typeof r.debug&&r.debug("Web Socket Opened..."),n["accept-version"]=c.VERSIONS.supportedVersions(),n["heart-beat"]=[r.heartbeat.outgoing,r.heartbeat.incoming].join(","),r._transmit("CONNECT",n)})},t.prototype.disconnect=function(t,n){return null==n&&(n={}),this._transmit("DISCONNECT",n),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},t.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&c.clearInterval(this.pinger),this.ponger)return c.clearInterval(this.ponger)},t.prototype.send=function(t,n,e){return null==n&&(n={}),null==e&&(e=""),n.destination=t,this._transmit("SEND",n,e)},t.prototype.subscribe=function(t,n,e){var i;return null==e&&(e={}),e.id||(e.id="sub-"+this.counter++),e.destination=t,this.subscriptions[e.id]=n,this._transmit("SUBSCRIBE",e),i=this,{id:e.id,unsubscribe:function(){return i.unsubscribe(e.id)}}},t.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},t.prototype.begin=function(t){var n,e;return e=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:e}),n=this,{id:e,commit:function(){return n.commit(e)},abort:function(){return n.abort(e)}}},t.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},t.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},t.prototype.ack=function(t,n,e){return null==e&&(e={}),e["message-id"]=t,e.subscription=n,this._transmit("ACK",e)},t.prototype.nack=function(t,n,e){return null==e&&(e={}),e["message-id"]=t,e.subscription=n,this._transmit("NACK",e)},t}(),c={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,n){var e;return null==n&&(n=["v10.stomp","v11.stomp"]),e=new(c.WebSocketClass||WebSocket)(t,n),new i(e)},over:function(t){return new i(t)},Frame:b},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=c),"undefined"!=typeof window&&null!==window?(c.setInterval=function(t,n){return window.setInterval(n,t)},c.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=c):exports||(self.Stomp=c)}).call(this);